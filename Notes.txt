Add connect to send first command
1 sec timer then check for data.  Reset timer
Read first byte to determine total number of bytes 
Read total bytes
Parse data
Print to Rich text box

BYTE COUNT DOES NOT  INCLUDE CHECKSUM
SO LENGTH = BYTE COUNT + 1

** FOR WRITE COMMANDS
	EACH COMAND NEEDS A BOOL FOR EXPECTED READ AND INT FOR LENGTH IF REQUIRED

	SET DATE TIME RETURNS 2 BYTES + CHECKSUM


	TODO
	---------------------------------------------------------------------

	Change Thread.Sleep(1000); to a timer

	Still getting comm errors.  How to fix?  If byte count is too high try to use only lower part?

	Set up for marine and hires mode (1 sec and 10 sec)


	Complete meter status and port C status

	Auto start	-	Add startup wizard - verify via user spring tension is correct

	Servo loop to level platform for auto  start - wait for XACC and LACC to drop below +/- 10 for 3 counts

	Startup - FOG/ heater status - not changing to green before timing out

			- Enable don't wait for heater option

	Data file	-	Add timer for closing and opening new file
				-	initial is 24 hour at midnight
				-	Add other options later

	Add raw beam to user data form

	Chart		-	Add option to enable cross coupling parameters chart
				-	Add ZLS classic to color options
				-	Remove trace markers from options
				-	Remove chart type from options
				-	Enable background color in options
				-	Remove chart window options - set to 10 min for 1 sec and 60 min for 10 sec
				-	Add new Y axis for cross coupling - make it auto
				-	Add labels to Y axis for accelerometers and cross coupling
				-	See if I need another filter for chart data

	Time/ Date	-	Enable time set
				-	Options 1) manual	2) from system clock
				-	Add note that GPS time will override manual settings when GPS is connected
				-	Can I select if it will override?
				-	Add message box for time set success/ failure
				-	Add second date/time label with GPS time next to it.  Set color of not used time to grey  Other system time

	Alarm		-	Add alarm functions - what are they?

	Cal data	-	Enable writing cal data to meter from parameters form

	User parameters	-	add user parameter form with limited functions
					-	have form upen based on login

	RS232	-	Add data out functions with  various formats

	Datalog	-	Add format selection - standard and one new version


	Unit tests	-	Add more tests
				-	serial data send calculation
				-	checksum calculation
				-	file write
				-	file open
				-	file read

GPS	-	Change lon and lat to deg min sec - maybe N W etc

User data form - fix everything




 IFIL PROBABLY IS FROM MODE MARINE OR HI
screen write
ISCFLG = 1    RAWG, data(IFIL)[6 -> 10, 13, 14]
ISCFLG = 2    LINEID, DAY, HR, MIN, SEC, DATA4[3], DATA1[3],DATA(IFIL)[4], DATA1[5], TC
ISCFLG = 3    PRSTATS
ISCFLG = 4    LAT, LON, ALT, ISHFT(GPSTATS, -6)



/*  IFIL PROBABLY IS FROM MODE MARINE OR HI
RS232 WRITE
MODESW = 1    LINEID, DAY, HR, MIN, SEC, GRAV, DATA1[3], DATA1[4], BSCALE * DATA1[5] ,  data1[6 -> 14], LAT, LON, ALT,GPSTATS, APERX * 1.0E6
MODESW = 2    LINEID, DAY, HR, MIN, SEC, GRAV, DATA4[3], DATA4[4], BSCALE * DATA4[5] ,  data4[6 -> 14], LAT, LON, ALT,GPSTATS, APERX * 1.0E6


RNS 2 BYTES + CHECKSUM







old slew


        //SpringTensionStep(double target, string slewType)

/*
        private void SpringTensionStep(double target, string slewType)
        {
            Boolean okToSlew = false;
            double shift = target;// target = 100
                                  //  shift = springTensionMax - CalculateMarineData.data1[3] - 500;
                                  //shift = 100
                                  // istop = 1
                                  // spring tension = 1414.5
                                  // stscale = .1041666
                                  // M = 960

            if (engineerDebug)
            {
                Console.WriteLine("FMPM = " + fmpm);
                Console.WriteLine("Slew " + slewType);
                Console.WriteLine("Current ST " + Data.SpringTension);
                Console.WriteLine("Initial shift = " + shift);
            }

            switch (slewType)
            {
                case "absolute":
                    //  shift = target - CalculateMarineData.data1[3];
                    shift = target - Data.SpringTension;

                    break;

                case "relative":

                    if (iStop > 1)
                    {
                        // goto 109  startup wizard is active
                    }
                    if (Math.Abs(shift) > fmpm)  // FMPM is MGAL/Min
                    {
                        springTensionValueLabel.Text = Convert.ToString(Math.Abs(shift) / fmpm);
                        // this is currently printed to screen
                    }

                    break;

                case "park":
                    // shift = springTensionMax - CalculateMarineData.data1[3] - 500;
                    shift = springTensionMax - Data.SpringTension - 500;
                    break;

                default:
                    break;
            }
            //            if ((shift + CalculateMarineData.data1[3] > springTensionMax) || shift + CalculateMarineData.data1[3] < 100)

            if ((shift + Data.SpringTension > springTensionMax) || (shift + Data.SpringTension < 100) || (target > springTensionMax) || (Math.Abs(shift) > springTensionMax - 500))
            {
                okToSlew = false;
                MessageBox.Show("Error", "Spring tension out of range.", MessageBoxButtons.OK, MessageBoxIcon.Exclamation);
            }
            else
            {
                TimerWithDataCollection("stop");
                okToSlew = true;
            }

            //---------------------------------------------------------------------------------------------
            // not sure where to put these yet
            if (Math.Abs(shift) > springTensionFPM)
            {
                if (engineerDebug)
                {
                    Console.WriteLine(Math.Abs(shift) / springTensionFPM);
                }
                // print to some label or text box etc
            }
            //---------------------------------------------------------------------------------------------------
            if (okToSlew)
            {
                int M = 0;

                int sign = 1;
                // 2500 steps/sec = 87.5 mGal/10 sec = 525 mGal/min

                if (shift > 0)
                {
                    //if(ISTOP > 1){}// startup wizard active
                    if (Math.Abs(shift) > fmpm)// fmpm = 2340  what is this??
                    {
                        // write to screen Math.abs(shift)/fmpm
                    }

                    if (shift + Data.data1[3] > springTensionMax)
                    {
                        // goto 1000
                    }
                    if (shift + Data.data1[3] < 100)
                    {
                        // goto 1000
                    }

                    M = Convert.ToInt32(Math.Abs(shift / springTensionScale)); // scale == .1041666


                    //sign = Math.Abs(Convert.ToSByte(M) * springTensionScale);
                    iStep[4] = springTensionMaxStep;

                    if (M < springTensionMaxStep)
                    {

                    }


                    if (M * springTensionScale > 0)
                    {
                        sign = 1;
                    }
                    else
                    {
                        sign = -1;
                    }
 
                }
                else
                {
                    sign = -1 * Math.Abs(M * springTensionScale);

                }

                  Data.data1[3] *= sign;// FORTRAN SIGN(M * springTensionScale, shift


                Data.SpringTension += sign;
                var tempSt = Math.Round(Convert.ToDouble(Data.SpringTension), 1);
                Data.SpringTension = Convert.ToSingle(tempSt);

                if (engineerDebug)
                {
                    Console.WriteLine("New ST = " + Data.SpringTension);
                }

                iStep[4] = -springTensionMaxStep;

                if (shift > 0)
                {
                    iStep[4] = springTensionMaxStep;
                }

                while (M >= springTensionMaxStep)
                {
                    springTensionStatusLabel.Text = ("Please wait 10 sec");
                    springTensionValueLabel.Text = Convert.ToString(Math.Round(.5 + M * springTensionScale));
                    sendCmd("Slew Spring Tension");
                    Task taskA = Task.Factory.StartNew(() => DoSomeWork(10000));
                    taskA.Wait();
                    STtextBox.Text = Convert.ToString(Data.SpringTension);
                    M -= springTensionMaxStep;
                }

                iStep[4] = -1 * Convert.ToInt32(M);
                if (shift > 0)
                {
                    iStep[4] *= -1;
                }
                springTensionStatusLabel.Text = ("Please wait 10 sec");
                springTensionValueLabel.Text = Convert.ToString(Math.Round(.5 + M * springTensionScale));
                sendCmd("Slew Spring Tension");
                // convert text box etc.
                // send_cmd 3
                Task taskB = Task.Factory.StartNew(() => DoSomeWork(10000));
                taskB.Wait();
                STtextBox.Text = Convert.ToString(Data.SpringTension);
                // sleep 10 sec  need to stop timer for this
                // return

                springTensionStatusLabel.Text = ("All done");
                springTensionTargetNumericTextBox.Text = null;
                taskB = Task.Factory.StartNew(() => DoSomeWork(300));
                taskB.Wait();
                TimerWithDataCollection("stop");
                springTensionGroupBox.Visible = false;
            }
        }
        */